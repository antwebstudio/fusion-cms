"use strict";(self.webpackChunkfusioncms=self.webpackChunkfusioncms||[]).push([[3257],{3257:(e,t,o)=>{o.r(t),o.d(t,{default:()=>m,getBlueprint:()=>d});var n=o(3802);var r=o(8401),i={class:"buttons"},a={class:"card"},s={class:"card__body"};const c={data:function(){return{placements:[{label:"Body",value:"body"},{label:"Sidebar",value:"sidebar"}]}},props:{resource:{type:Object,required:!1,default:function(){}},form:{type:Object,required:!0},loading:{type:Boolean,required:!1}},methods:{remove:function(){var e=this.$store.getters["blueprint/getRemoveIndex"];this.form.sections.length>0&&this.form.sections.splice(e,1)}},created:function(){this.$store.commit("fieldtypes/setStructure",this.resource.structure.toLowerCase())}};var u=o(3744);const l={auth:function(){return{permission:"blueprints.update"}},head:{title:function(){return{inner:_.has(this.form,"name")?this.form.name:"Loading..."}}},data:function(){return{id:null,resource:null,form:null,loading:!1}},components:{"shared-form":(0,u.Z)(c,[["render",function(e,t,o,r,c,u){var l=(0,n.resolveComponent)("ui-button"),d=(0,n.resolveComponent)("portal"),m=(0,n.resolveComponent)("status-card"),f=(0,n.resolveComponent)("sidebar"),p=(0,n.resolveComponent)("section-card"),h=(0,n.resolveComponent)("ui-title-group"),v=(0,n.resolveComponent)("blueprint");return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[(0,n.createVNode)(d,{to:"actions"},{default:(0,n.withCtx)((function(){return[(0,n.createElementVNode)("div",i,["sm"!=e.$mq?((0,n.openBlock)(),(0,n.createBlock)(l,{key:0,to:{name:"blueprints"},variant:"secondary"},{default:(0,n.withCtx)((function(){return[(0,n.createTextVNode)("Go Back")]}),void 0,!0),_:1})):(0,n.createCommentVNode)("",!0),(0,n.createVNode)(l,{type:"submit",onClick:(0,n.withModifiers)(e.$parent.submit,["prevent"]),variant:"primary",disabled:!o.form.hasChanges||o.loading},{default:(0,n.withCtx)((function(){return[(0,n.createTextVNode)("Save")]}),void 0,!0),_:1},8,["onClick","disabled"])])]}),void 0,!0),_:1}),(0,n.createVNode)(d,{to:"sidebar-right"},{default:(0,n.withCtx)((function(){return[(0,n.withDirectives)((0,n.createElementVNode)("div",null,[(0,n.createVNode)(f,{id:"blueprint-sidebar"},{default:(0,n.withCtx)((function(){return[o.resource?((0,n.openBlock)(),(0,n.createBlock)(m,{key:0,entry:o.resource,id:"blueprint_panel_status_card",tabindex:"-1"},null,8,["entry"])):(0,n.createCommentVNode)("",!0)]}),void 0,!0),_:1})],512),[[n.vShow,!o.loading]])]}),void 0,!0),_:1}),(0,n.withDirectives)((0,n.createVNode)(p,{title:"Loading..."},null,512),[[n.vShow,o.loading]]),(0,n.withDirectives)((0,n.createElementVNode)("div",null,[(0,n.createElementVNode)("div",a,[(0,n.createElementVNode)("div",s,[(0,n.createVNode)(h,{name:"name",readonly:"","has-error":o.form.errors.has("name"),"error-message":o.form.errors.get("name"),modelValue:o.form.name,"onUpdate:modelValue":t[0]||(t[0]=function(e){return o.form.name=e})},null,8,["has-error","error-message","modelValue"]),(0,n.createVNode)(v,{placements:c.placements,form:o.form},null,8,["placements","form"])])])],512),[[n.vShow,!o.loading]])])}]])},methods:{submit:function(){var e=this;this.loading=!0,this.form.patch("/api/blueprints/".concat(this.resource.id)).then((function(){axios.post("/api/blueprints/".concat(e.resource.id,"/sections"),{sections:e.form.sections}).then((function(){toast("Blueprint successfully updated","success"),e.$router.push("/blueprints")})).catch((function(t){toast(t.message,"failed"),e.loading=!1}))})).catch((function(t){toast(t.response.data.message,"failed"),e.loading=!1}))}},beforeRouteEnter:function(e,t,o){d(e.params.blueprint,(function(e,t){o(e?function(t){t.$router.push("/blueprints"),toast(e.toString(),"danger")}:function(e){e.resource=t,e.form=new r.Z({name:t.name,sections:t.sections},!0),e.$nextTick((function(){window.emitter.emit("updateHead")}))})}))}};function d(e,t){axios.get("/api/blueprints/"+e).then((function(e){t(null,e.data.data)})).catch((function(e){t(new Error("The requested blueprint could not be found"))}))}const m=(0,u.Z)(l,[["render",function(e,t,o,r,i,a){var s=(0,n.resolveComponent)("page-title"),c=(0,n.resolveComponent)("portal"),u=(0,n.resolveComponent)("shared-form");return(0,n.openBlock)(),(0,n.createElementBlock)("div",null,[(0,n.createVNode)(c,{to:"title"},{default:(0,n.withCtx)((function(){return[(0,n.createVNode)(s,{icon:"list"},{default:(0,n.withCtx)((function(){return[(0,n.createTextVNode)("Edit Blueprint")]}),void 0,!0),_:1})]}),void 0,!0),_:1}),i.form?((0,n.openBlock)(),(0,n.createBlock)(u,{key:0,loading:i.loading,form:i.form,resource:i.resource},null,8,["loading","form","resource"])):(0,n.createCommentVNode)("",!0)])}]])}}]);